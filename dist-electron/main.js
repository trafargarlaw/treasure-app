"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("electron"),s=require("fs"),d=require("node:module"),t=require("node:path"),f=require("node:url");var a=typeof document<"u"?document.currentScript:null;d.createRequire(typeof document>"u"?require("url").pathToFileURL(__filename).href:a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("main.js",document.baseURI).href);const l=t.dirname(f.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("main.js",document.baseURI).href));process.env.APP_ROOT=t.join(l,"..");const i=process.env.VITE_DEV_SERVER_URL,h=t.join(process.env.APP_ROOT,"dist-electron"),c=e.app.isPackaged?t.join(process.resourcesPath,"app.asar/dist"):t.join(process.env.APP_ROOT,"dist");process.env.VITE_PUBLIC=i?t.join(process.env.APP_ROOT,"public"):c;let r;function R(n){try{if(!e.safeStorage.isEncryptionAvailable())return console.error("Storage encryption is not available"),!1;const o=e.safeStorage.encryptString(n),u=t.join(e.app.getPath("userData"),"auth-token");return s.writeFileSync(u,o),!0}catch(o){return console.error("Failed to store token:",o),!1}}function _(){try{if(!e.safeStorage.isEncryptionAvailable())return console.error("Storage encryption is not available"),null;const n=t.join(e.app.getPath("userData"),"auth-token");if(!s.existsSync(n))return null;const o=s.readFileSync(n);return e.safeStorage.decryptString(o)}catch(n){return console.error("Failed to retrieve token:",n),null}}e.ipcMain.handle("store-token",async(n,o)=>R(o));e.ipcMain.handle("get-token",async()=>_());e.ipcMain.handle("delete-token",async()=>{try{const n=t.join(e.app.getPath("userData"),"auth-token");return s.existsSync(n)&&s.unlinkSync(n),!0}catch(n){return console.error("Failed to delete token:",n),!1}});function p(){if(r=new e.BrowserWindow({icon:e.app.isPackaged?t.join(process.resourcesPath,"app.asar/dist","icon.png"):t.join(process.env.VITE_PUBLIC,"icon.png"),webPreferences:{preload:t.join(l,"preload.mjs"),nodeIntegration:!0},width:320,height:680,alwaysOnTop:!0,maxHeight:800}),r.setAlwaysOnTop(!0,"screen-saver"),r.webContents.openDevTools(),r.webContents.on("did-finish-load",()=>{r==null||r.webContents.send("main-process-message",new Date().toLocaleString())}),i)r.loadURL(i);else{const n=t.join(c,"index.html");r.loadFile(n)}}e.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(e.app.quit(),r=null)});e.app.on("activate",()=>{e.BrowserWindow.getAllWindows().length===0&&p()});e.app.whenReady().then(p);exports.MAIN_DIST=h;exports.RENDERER_DIST=c;exports.VITE_DEV_SERVER_URL=i;
